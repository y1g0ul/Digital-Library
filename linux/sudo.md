---
created-dt: 2026-01-06 02:18
tags:
  - review
sr-due: 2026-04-05
sr-interval: 55
sr-ease: 250
---
Все действия в [[Linux]] от имени суперпользователя выполняются через систему `sudo`.

1. `sudo -i` (Login Shell)
**Создает полноценную root-сессию**, как если бы вы залогинились под `root` напрямую.  
**Что происходит:**  
- Читает файлы настроек (`/root/.bashrc`, `/root/.profile`).  
- Меняет переменные окружения (`HOME=/root`, `PATH=/usr/local/sbin:/usr/sbin:/sbin`).  
- Рабочая директория становится `/root`.  
**Пример:**  
```bash
sudo -i
# Теперь вы root, окружение "чистое", как при логине.
```

---

 2. `su` (Switch User)

**Переключает текущую оболочку**, на другого пользователя.  В отличие от `sudo`, требует пароль **целевого** пользователя. В простейшем случае надо набрать `su user`, где `user` имя пользователя, в которого мы хотим переключиться.
**Что происходит:**
- Запускает **новую оболочку** с [[uid]] и [[gid]] целевого пользователя.
- По умолчанию **не создаёт** `login shell` (если не указан флаг `-`).
- Переменные окружения **частично сохраняются** от текущего пользователя.
- Рабочая директория **не меняется**.
**Пример:**
``` bash
su -c id  petrov
# uid=1002(petrov) gid=1003(petrov) groups=1003(petrov),1001(developer)
```

---
3. `sudo su` (Switch User)
Переключает пользователя на `root` **без полноценного логина**.  
**Что происходит:**  
- Не загружает настройки из `/root/.bashrc` и `/root/.profile` (если не добавить `-l`, т.е. `sudo su -`).  
- Сохраняет текущие переменные окружения (например, [[$PATH]] остаётся как у вашего пользователя).  
- Рабочая директория не меняется.  

---
**Файл настроек** sudo - `/etc/sudoers`. Лучше не редактировать этот файл **напрямую**, для этого используют команду `visudo`.

Строки файла `/etc/sudoers` в простейшем варианте имеют следующий формат `user host=command`:
 - `user` - имя пользователя или группы (если начинается с `%`). `ALL` для всех пользователей. Заданные пользователи или участники группы имеют **права выполнять команды** на **указанных хостах** с правами суперпользователя.
 - `host` — обычно на этом месте строчка `ALL`, что идентифицирует **все компьютеры в сети**. Также здесь  может быть `localhost`, то есть локальный компьютер или `имя/адрес` компьютера. Поле полезно, когда в большой сети поддерживается **единый файл** `/etc/sudoers` и на разных компьютерах этой сети в sudo требуется разрешить разные команды.
 - `Command` — может быть` ALL` для любой команды или список команд. Возможно указание опций, например:
	 - `NOPASSWD` -  разрешает выполнение команды без **запроса пароля**. Команду обязательно надо указывать с **полным путем**. В качестве примера разрешим пользователю `user` через `sudo` выполнять остановку системы командой `shutdown` без запроса пароля. Это можно сделать, добавив в `/etc/sudoers` строчку `user ALL=NOPASSWD: /sbin/shutdown`.
	 - Если же вы хотите назначить права через группу, создайте группу `shutdown` и в `/etc/sudoers` укажите `%shutdown ALL=NOPASSWD: /sbin/shutdown`.

Кроме выполнения команд от **имени суперпользователя**, `sudo` можно использовать для выполнения команд с любыми [[gid]] или [[uid]]. В таком варианте в `/etc/sudoers` используется более сложный формат `user   host=(user:group) command`. Такое право даёт пользователю членство в группе `sudo`, которая описана в стандартном `/etc/sudoers` строкой:
``` bash
# Allow members of group sudo to execute any command

%sudo   ALL=(ALL:ALL) ALL
```

`sudo` можно использовать для запуска команд от **имени других пользователей** и **групп** c помощью ключей `-u` и `-g`:
- `sudo -u petrov id`
- `sudo -u petrov -g developer  id`